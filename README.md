# Nelder-Mead method

## Теория

**Симплекс** — это простейший выпуклый многогранник в данном пространстве, имеющий на одну вершину больше, чем размерность этого самого пространства.

Если говорить языком формул: в $n$-мерном пространстве симплекс имеет ровно $n + 1$ вершину.

При поиске минимума целевой функции $f(x)$ пробные векторы $x$ могут быть выбраны в точках $E^n$, находящихся в вершинах симплекса, как было первоначально предложено Спендли, Хекстом и Химсвортом. Координаты вершин регулярного симплекса определяются следующей матрицей $D$, в которой столбцы представляют собой вершины, пронумерованные от $1$ до $n+1$, а строчки - координаты, $i$ принимает значение от $1$ до $n$. $$D=\begin{pmatrix} 0&d_1&d_2&...&d_2 \\ 0&d_2&d_1&...&d_2 \\ 0&d_2&d_2&...&d_2 \\ ...&...&...&...&... \\ 0&d_2&d_2&...&d_1 \end{pmatrix}\;-\;\text{матрица }n\times(n+1),$$где $$d_1=\frac{t}{n\sqrt{2}}\cdot\left(\sqrt{n+1}+n-1\right)$$$$d_2=\frac{t}{n\sqrt{2}}\cdot\left(\sqrt{n+1}-1\right),$$где $t-$расстояние между двумя вершинами.

Определенные практические трудности, встречающиеся при использовании регулярных симплексов, а именно отсутствие ускорения поиска и трудности при проведении поиска на искривленных "оврагах" и "хребтах", привели к необходимости некоторых улучшений методов. В следующем методе Нелдера и Мида, в котором симплекс может изменять свою форму и таким образом уже не будет оставаться симплексом. Именно поэтому здесь используется более подходящее название "деформируемый многогранник".

В методе Нелдера и Мида минимизируется функция $n$ независимых переменных с использованием $n+1$ вершин деформируемого многогранника в $E^n$. Каждая вершина может быть идентифицирована вектором $x$. Вершина (точка) в $E^n$, в которой значение $f(x)$
максимально, проектируется через центр тяжести (центроид) оставшихся вершин. Улучшенные (более низкие) значения целевой функции находятся последовательной заменой точки с максимальным значением $f(x)$ на более "хорошие" точки, пока не будет найден минимум $f(x)$.

Более подробно этот алгоритм может быть описан следующим образом.
Пусть $x_i^{(k)}=[x_{i1}^{(k)},...,x_{ij}^{(k)},...,x_{in}^{(k)}],\;i=1,...,n+1,$ является $i-й$ вершиной (точкой) в $E^n$ на $k-м$ этапе поиска, $k=0,1,...,$ и пусть значение целевой  функции в $x_i^{(k)}$ равно $f(x_i^{(k)})$. Кроме того, отметим те векторы $x$ многогранника, которые дают максимальное и минимальное значение $f(x)$.
Определим $$f(x_h^{(k)})=\max\{ f(x_1^{(k)}),...,f(x_{n+1}^{(k)})\},$$где $x_h^{(k)}=x_i^{(k)},$ и $$f(x_i^{(k)})=\min\{ f(x_1^{(k)}),...,f(x_{n+1}^{(k)})\},$$где $x_l^{(k)}=x_i^{(k)}$. Поскольку многогранник в $E^n$ состоит из $(n+1)$ вершин $x_1,...,x_{n+1},$ пусть $x_{n+2}$ будет центром тяжести всех вершин, исключая $x_h$.
Тогда координаты этого центра определяются формулой$$x_{n+2,j}^{(k)}=\frac{1}{n}\left[ \left( \sum_{i=1}^{n+1} x_{ij}^{(k)} \right) -x_{hj}^{(k)} \right],\;\;\;\;\;j=1,...,n,\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\text{(1)}$$где индекс $j$ обозначает координатное направление.
Начальный многогранник обычно выбирается в виде регулярного симплекса (но это не обязательно) с точкой $1$ в качестве начала координат; можно начало координат поместить в центре тяжести, как это имеет место в машинной программе. 
Процедура отыскания вершины в $E^n,$ в которой $f(x)$ имеет лучшее значение, состоит из следующих операций:
1. **Отражение** - проектирование $x_h^{(k)}$ через центр тяжести в соответствии с соотношением: $$x_{n+3}^{(k)}=x_{n+2}^{(k)}+\alpha\cdot(x_{n+2}^{(k)}-x_h^{(k)}),$$где $\alpha>0$ является коэффициентом отражения; $x_{n+2}^{(k)}-$центр тяжести, вычисляемый по формуле $(1);$ $x_h^{(k)}-$вершина, в которой функция $f(x)$ принимает наибольшее из $n+1$ ее значений на $k-м$ этапе.
2. **Растяжение**. Эта операция заключается в следующем: если $f(x_{n+3}^{(k)})\le f(x_l^{(k)}),$ то вектор $(x_{n+3}^{(k)}-x_{n+2}^{(k)})$ растягивается в соответствии с соотношением$$x_{n+4}^{(k)}=x_{n+2}^{(k)}+\gamma\cdot(x_{n+3}^{(k)}-x_{n+2}^{(k)}),$$где $\gamma>1$ представляет собой коэффициент растяжения. Если $f(x_{n+4}^{(k)})<f(x_l^{(k)}),$ то $x_h^{(k)}$ заменяется на $x_{n+4}^{(k)}$ и процедура продолжается снова с операции 1 при $k=k+1$. В противном случае $x_h^{(k)}$ заменяется на $x_{n+3}^{(k)}$ и также осуществляется переход к операции 1 при $k=k+1$.
3. **Сжатие**. Если $f(x_{n+3}^{(k)})>f(x_i^{(k)})$ для всех $i\not=h,$ то вектор $(x_h^{(k)}-x_{n+2}^{(k)})$ сжимается в соответствии с формулой$$x_{n+5}^{(k)}=x_{n+2}^{(k)}+\beta\cdot(x_h^{(k)}-x_{n+2}^{(k)}),$$где $0<\beta<1$ представляет собой коэффициент сжатия. Затем $x_h^{(k)}$ заменяем на $x_{n+5}^{(k)}$ и возвращаемся к операции 1 для продолжения поиска на $(k+1)-м$ шаге.
4. **Редукция**. Если $f(x_{n+3}^{(k)})>f(x_{h}^{(k)}),$ все векторы $(x_i^{(k)}-x_l^{(k)}),$ $i=1,...,n+1,$ уменьшаются в 2 раза с отсчетом от $x_l^{(k)}$ в соответствии с формулой $$x_i^{(k)}=x_l^{(k)}+0,5\cdot(x_i^{(k)}-x_l^{(k)}),\;\;\;i=1,...,n+1$$
Затем возвращаемся к операции 1 для продолжения поиска на $(k+1)-м$ шаге.
Критерий окончания поиска, использованный Нелдером и Мидом, состоял в проверке условия $$\sqrt{ \frac{1}{n+1}\sum_{i=1}^{n+1}\left[ f(x_i^{(k)})-f(x_{n+2}^{(k)}) \right]^2}\le\varepsilon,$$где $\varepsilon-$произвольное малое число, а $f(x_{n+2}^{(k)})-$значение целевой функции в центре тяжести $x_{n+2}^{(k)}$.

## Блок-схема алгоритма
![Блок-схема метода деформируемого многогранника](flow_chart.png)
